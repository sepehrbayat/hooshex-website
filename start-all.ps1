# Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ú©Ø§Ù…Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ - HooshEx Website
# Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

param(
    [switch]$SkipDocker = $false
)

$ErrorActionPreference = "Stop"

Write-Host ""
Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
Write-Host "â•‘   Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ HooshEx Website      â•‘" -ForegroundColor Cyan
Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host ""

$scriptRoot = Split-Path -Parent $MyInvocation.MyCommand.Path
Set-Location $scriptRoot

# Ù…Ø±Ø­Ù„Ù‡ 1: Ø¨Ø±Ø±Ø³ÛŒ Docker
if (-not $SkipDocker) {
    Write-Host "[1/4] Ø¨Ø±Ø±Ø³ÛŒ Docker Desktop..." -ForegroundColor Yellow
    try {
        docker ps | Out-Null
        Write-Host "    âœ… Docker Desktop Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª" -ForegroundColor Green
    } catch {
        Write-Host "    âŒ Docker Desktop Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ù†ÛŒØ³Øª!" -ForegroundColor Red
        Write-Host "    Ù„Ø·ÙØ§Ù‹ Docker Desktop Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯." -ForegroundColor Yellow
        exit 1
    }

    # Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Docker Services
    Write-Host "[2/4] Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Docker..." -ForegroundColor Yellow
    docker compose up -d
    
    if ($LASTEXITCODE -ne 0) {
        Write-Host "    âŒ Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Docker services!" -ForegroundColor Red
        exit 1
    }
    
    Write-Host "    âœ… Docker services Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯Ù†Ø¯" -ForegroundColor Green
    Start-Sleep -Seconds 3
} else {
    Write-Host "[1/4] Ø±Ø¯ Ú©Ø±Ø¯Ù† Docker (--SkipDocker ÙØ¹Ø§Ù„ Ø§Ø³Øª)" -ForegroundColor Gray
    Write-Host "[2/4] Ø±Ø¯ Ú©Ø±Ø¯Ù† Docker (--SkipDocker ÙØ¹Ø§Ù„ Ø§Ø³Øª)" -ForegroundColor Gray
}

# Ù…Ø±Ø­Ù„Ù‡ 3: Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
Write-Host "[3/4] Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§..." -ForegroundColor Yellow

if (-not (Test-Path "node_modules")) {
    Write-Host "    ğŸ“¦ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Node.js..." -ForegroundColor Cyan
    npm install
    if ($LASTEXITCODE -ne 0) {
        Write-Host "    âŒ Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Node.js!" -ForegroundColor Red
        exit 1
    }
}

if (-not (Test-Path "vendor")) {
    Write-Host "    ğŸ“¦ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Composer..." -ForegroundColor Cyan
    composer install
    if ($LASTEXITCODE -ne 0) {
        Write-Host "    âŒ Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Composer!" -ForegroundColor Red
        exit 1
    }
}

Write-Host "    âœ… ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ù‡Ø³ØªÙ†Ø¯" -ForegroundColor Green

# Ù…Ø±Ø­Ù„Ù‡ 4: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§
Write-Host "[4/4] Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Laravel Ùˆ Vite..." -ForegroundColor Yellow
Write-Host ""
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host "   ğŸŒ Ø³Ø±ÙˆØ±Ù‡Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ..." -ForegroundColor Green
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host ""
Write-Host "ğŸ“Œ Laravel:  http://127.0.0.1:7668" -ForegroundColor White
Write-Host "ğŸ“Œ Vite:     http://127.0.0.1:6365" -ForegroundColor White
Write-Host ""
Write-Host "ğŸ“Œ Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ:  http://127.0.0.1:7668/app/login" -ForegroundColor Cyan
Write-Host "ğŸ“Œ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†:   http://127.0.0.1:7668/admin/login" -ForegroundColor Cyan
Write-Host ""
Write-Host "â¹ï¸  Ø¨Ø±Ø§ÛŒ ØªÙˆÙ‚Ù Ø³Ø±ÙˆØ±Ù‡Ø§: Ctrl+C" -ForegroundColor Yellow
Write-Host ""
Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host ""

# Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù†Ø¯)
$nodeProcesses = Get-Process -Name node -ErrorAction SilentlyContinue | Where-Object { $_.Path -like "*$scriptRoot*" }
if ($nodeProcesses) {
    Write-Host "âš ï¸  Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ..." -ForegroundColor Yellow
    Stop-Process -Name node -Force -ErrorAction SilentlyContinue
    Start-Sleep -Seconds 2
}

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§
npm run start

